include ./components/headTemplate

headTemplate
body
    header(class="jumbotron")
        h1(class="display-4") Trapped requests table
    div(class='container')
        div(class='row')
            div(class='col')
                table(class="table")
                    thead
                        tr
                            th(scope="col") #
                            th(scope="col") Method
                            th(scope="col") Query params
                            th(scope="col") Url
                            th(scope="col") Schema
                            th(scope="col") Trap ID
                            th(scope="col") Request date
                    tbody(id='table')
                        each request in requests
                            tr
                                th
                                th= request.method
                                td= JSON.stringify(request.params)
                                td= request.url
                                td= request.httpSchema
                                td= request.trapId
                                td= new Date(request.date).toUTCString()
    script.
        const [,trapName] = window.location.pathname.split('/')
        const {hostname,port} = window.location;

        const socket = io.connect(`http://${hostname}:${port}`, {
            query: {
                trapName: trapName
            }
        });

        const table = document.getElementById('table');

        socket.on(`${trapName}`, function ({data}) {

            const newRowHtml = createTableRow(data);

            insertHTMLToNode(table, newRowHtml);
        });

        function insertHTMLToNode (node, html) {
            node.innerHTML = `${node.innerHTML}${html}`;
        }

        function createTableRow(message) {

            const {method,params, url,httpSchema,trapId,trapName,date} = message;

                return `
                         <tr>
                              <th></th>
                              <th>${method}</th>
                              <td>${JSON.stringify(params)}</th>
                              <td>${url}</th>
                              <td>${httpSchema}</th>
                              <td>${trapId}</th>
                              <td>${new Date(date).toUTCString()}</th>
                        </tr>
                `;
        }
footer